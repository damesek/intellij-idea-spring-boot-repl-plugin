<idea-plugin>
    <id>hu.baader.java-over-nrepl</id>
    <name>Spring Boot REPL</name>
    <vendor email="support@baader.hu" url="https://baader.hu">Baader</vendor>
    
    <description><![CDATA[
      Spring Boot REPL for IntelliJ IDEA.<br/>
      Evaluate Java code against a live Spring Boot application, with automatic context binding and hot-reload support.
      <br/><br/>
      <b>Features</b>
      <ul>
        <li>Attach a lightweight dev-runtime agent to a running Spring Boot JVM</li>
        <li>JShell-based Java REPL with stateful imports and variables</li>
        <li>Automatic Spring context binding and a pre-initialized <code>ctx</code> (ApplicationContext) helper</li>
        <li>Hot-swap support for editing and reloading classes on the fly</li>
        <li>Editor actions: Run Selection, Evaluate at Caret, Reload Class, Sync Imports</li>
        <li>Optional HTTP panel for managing and replaying REST calls</li>
      </ul>
      <br/>
      <b>Quick usage</b>
      <ol>
        <li>Add <code>sb-repl-bridge</code> and <code>sb-repl-agent</code> (or the dev-runtime agent JAR) to your Spring Boot project.</li>
        <li>Start the application and attach the agent (via JVM <code>-javaagent</code> option or the plugin's Attach action).</li>
        <li>Open the <b>Spring Boot REPL</b> tool window and press <b>Connect</b>; the plugin auto-binds the Spring context and initializes <code>ctx</code>.</li>
        <li>Run snippets such as <code>((com.example.AIService) ctx.getBean(com.example.AIService.class)).generateResponse("Hello")</code> directly against the live app.</li>
        <li>Use the editor Spring Boot REPL menu (Run Selection, Evaluate at Caret, Reload Class, Sync Imports) to drive the REPL from your source files.</li>
      </ol>
    ]]></description>
    
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>
    
    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Window -->
        <toolWindow id="Spring Boot REPL"
                    factoryClass="hu.baader.repl.ui.JavaReplToolWindowFactory"
                    anchor="bottom"/>

        <!-- Settings -->
        <applicationConfigurable
                instance="hu.baader.repl.settings.PluginSettingsConfigurable"
                id="hu.baader.repl.settings"
                displayName="Spring Boot REPL"/>

        <!-- Project startup -->
        <postStartupActivity implementation="hu.baader.repl.nrepl.ProjectStartup"/>

        <!-- Notification Group -->
        <notificationGroup id="Spring Boot REPL"
                          displayType="BALLOON"/>

        <!-- Project Service for HTTP request cases -->
        <projectService serviceImplementation="hu.baader.repl.ui.HttpRequestService"/>
    </extensions>
    
    <actions>
        <!-- Spring Boot REPL group in Code menu + editor popup -->
        <group id="hu.baader.repl.SpringReplGroup"
               text="Spring Boot REPL"
               popup="true">
            <add-to-group group-id="CodeMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Run Selection -->
        <action id="hu.baader.repl.RunEditorSelection"
                class="hu.baader.repl.actions.RunEditorSelectionAction"
                text="Run Selection"
                description="Send selection (or whole file) to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="ctrl shift R" keymap="$default"/>
        </action>

        <!-- Evaluate at Caret -->
        <action id="hu.baader.repl.EvaluateAtCaret"
                class="hu.baader.repl.actions.EvaluateAtCaretAction"
                text="Evaluate at Caret"
                description="Send expression at caret to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift E" keymap="$default"/>
        </action>

        <!-- Advanced Editor (session PSI + transcript, popup) -->
        <action id="hu.baader.repl.OpenAdvancedEditor"
                class="hu.baader.repl.actions.OpenAdvancedEditorAction"
                text="Advanced Editor"
                description="Open advanced Java editor with session PSI and transcript">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
        </action>

        <!-- Sync imports from editor file into JShell session -->
        <action id="hu.baader.repl.SyncImportsFromEditor"
                class="hu.baader.repl.actions.SyncImportsFromEditorAction"
                text="Sync Imports"
                description="Send current Java file imports to Spring REPL JShell session">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
        </action>

        <!-- Attach & Inject Dev Runtime -->
        <action id="hu.baader.repl.AttachDevRuntime"
                class="hu.baader.repl.actions.AttachDevRuntimeAction"
                text="Attach &amp; Inject Dev Runtime"
                description="Attach to a running JVM and load the dev runtime agent">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Bind Spring Context -->
        <action id="hu.baader.repl.BindSpringContext"
                class="hu.baader.repl.actions.BindSpringContextAction"
                text="Bind Spring Context"
                description="Bind Spring ApplicationContext into dev runtime for REPL usage">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Reload Class from Editor -->
        <action id="hu.baader.repl.ReloadClassFromEditor"
                class="hu.baader.repl.actions.ReloadClassFromEditorAction"
                text="Reload Class"
                description="Compile and hot-swap current editor file into target JVM">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift R" keymap="$default"/>
        </action>
    </actions>
</idea-plugin>
