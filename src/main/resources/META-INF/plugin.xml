<idea-plugin>
    <id>hu.baader.java-over-nrepl</id>
    <name>Java over nREPL</name>
    <vendor email="support@baader.hu" url="https://baader.hu">Baader</vendor>
    
    <description><![CDATA[
      Execute Java code through nREPL in IntelliJ IDEA.
      <br/><br/>
      Features:
      <ul>
        <li>Connect to nREPL server with Java middleware</li>
        <li>Execute Java code snippets</li>
        <li>Persistent settings (host, port, auto-connect)</li>
        <li>Tool window with REPL interface</li>
        <li>Run selection from editor</li>
      </ul>
    ]]></description>
    
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>
    
    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Window -->
        <toolWindow id="SB Tools"
                    factoryClass="hu.baader.repl.ui.JavaReplToolWindowFactory"
                    anchor="bottom"/>

        <!-- Settings -->
        <applicationConfigurable
                instance="hu.baader.repl.settings.PluginSettingsConfigurable"
                id="hu.baader.repl.settings"
                displayName="Java over nREPL"/>

        <!-- Project startup -->
        <postStartupActivity implementation="hu.baader.repl.nrepl.ProjectStartup"/>

        <!-- Notification Group -->
        <notificationGroup id="SB Tools"
                          displayType="BALLOON"/>

        <!-- Project Service for HTTP request cases -->
        <projectService serviceImplementation="hu.baader.repl.ui.HttpRequestService"/>
    </extensions>
    
    <actions>
        <!-- Spring REPL group in Code menu + editor popup -->
        <group id="hu.baader.repl.SpringReplGroup"
               text="Spring REPL"
               popup="true">
            <add-to-group group-id="CodeMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Run Selection -->
        <action id="hu.baader.repl.RunEditorSelection"
                class="hu.baader.repl.actions.RunEditorSelectionAction"
                text="Run Selection"
                description="Send selection (or whole file) to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="ctrl shift R" keymap="$default"/>
        </action>

        <!-- Evaluate at Caret -->
        <action id="hu.baader.repl.EvaluateAtCaret"
                class="hu.baader.repl.actions.EvaluateAtCaretAction"
                text="Evaluate at Caret"
                description="Send expression at caret to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift E" keymap="$default"/>
        </action>

        <!-- Sync imports from editor file into JShell session -->
        <action id="hu.baader.repl.SyncImportsFromEditor"
                class="hu.baader.repl.actions.SyncImportsFromEditorAction"
                text="Sync Imports"
                description="Send current Java file imports to Spring REPL JShell session">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
        </action>

        <!-- Attach & Inject Dev Runtime -->
        <action id="hu.baader.repl.AttachDevRuntime"
                class="hu.baader.repl.actions.AttachDevRuntimeAction"
                text="Attach &amp; Inject Dev Runtime"
                description="Attach to a running JVM and load the dev runtime agent">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Bind Spring Context -->
        <action id="hu.baader.repl.BindSpringContext"
                class="hu.baader.repl.actions.BindSpringContextAction"
                text="Bind Spring Context"
                description="Bind Spring ApplicationContext into dev runtime for REPL usage">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Reload Class from Editor -->
        <action id="hu.baader.repl.ReloadClassFromEditor"
                class="hu.baader.repl.actions.ReloadClassFromEditorAction"
                text="Reload Class"
                description="Compile and hot-swap current editor file into target JVM">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift R" keymap="$default"/>
        </action>
    </actions>
</idea-plugin>
