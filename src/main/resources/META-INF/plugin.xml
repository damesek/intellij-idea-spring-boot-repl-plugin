<idea-plugin>
    <id>hu.baader.java-over-nrepl</id>
    <name>Spring Boot REPL</name>
    <vendor email="support@baader.hu" url="https://baader.hu">Baader</vendor>
    
    <description><![CDATA[
      <b>Spring Boot REPL for IntelliJ IDEA</b><br/>
      Evaluate Java code against a live Spring Boot application via an in-process dev-runtime agent,
      with JShell-based jREPL, JavaCodeEvaluator-based jEval, snapshots, HTTP helpers and automatic Spring context binding.
      <br/><br/>
      <b>Key features</b>
      <ul>
        <li>Zero-config Spring Boot REPL run configuration (no extra dependencies or @ComponentScan needed)</li>
        <li>Bundled dev-runtime agent attached automatically via <code>-javaagent</code></li>
        <li>JShell-based <code>jREPL</code> (stateful imports &amp; defs) and <code>jEval</code> (JavaCodeEvaluator) modes</li>
        <li>Automatic Spring context binding with a pre-initialized <code>ctx</code> helper in the JShell session</li>
        <li>Hot-swap support for editing and reloading classes on the fly</li>
        <li>Snapshots &amp; Loaded Variables panel for capturing and reusing state</li>
        <li>HTTP panel for managing and replaying REST calls</li>
        <li>Editor actions: Run Selection, Evaluate at Caret, Reload Class, Sync Imports, Insert Bean Getter</li>
      </ul>
      <br/>
      <b>Quick usage (v0.8.0)</b>
      <ol>
        <li>Create a <b>Spring Boot REPL</b> run configuration and set the main class to your Spring Boot application.</li>
        <li>Run the configuration; the bundled dev-runtime agent attaches automatically and starts an in-process nREPL server.</li>
        <li>Open the <b>Spring Boot REPL</b> tool window; the plugin auto-connects and binds the Spring context so <code>ctx</code> is immediately available in jREPL.</li>
        <li>Evaluate snippets such as <code>ctx.getBean(com.example.AIService.class).generateResponse("Hello")</code> directly against the live app.</li>
        <li>Use the editor Spring Boot REPL menu (Run Selection, jEval, Reload Class, Sync Imports) to drive the REPL from your source files.</li>
      </ol>
    ]]></description>
    
    <depends>com.intellij.modules.platform</depends>
    <depends>com.intellij.modules.java</depends>
    
    <extensions defaultExtensionNs="com.intellij">
        <!-- Tool Window -->
        <toolWindow id="Spring Boot REPL"
                    factoryClass="hu.baader.repl.ui.JavaReplToolWindowFactory"
                    anchor="bottom"/>

        <!-- Settings -->
        <applicationConfigurable
                instance="hu.baader.repl.settings.PluginSettingsConfigurable"
                id="hu.baader.repl.settings"
                displayName="Spring Boot REPL"/>

        <!-- Project startup -->
        <postStartupActivity implementation="hu.baader.repl.nrepl.ProjectStartup"/>

        <!-- Notification Group -->
        <notificationGroup id="Spring Boot REPL"
                          displayType="BALLOON"/>

        <!-- Project Service for HTTP request cases -->
        <projectService serviceImplementation="hu.baader.repl.ui.HttpRequestService"/>

        <!-- Run Configuration Type -->
        <configurationType implementation="hu.baader.repl.runner.SpringBootReplConfigurationType"/>
    </extensions>
    
    <actions>
        <!-- Spring Boot REPL group in Code menu + editor popup -->
        <group id="hu.baader.repl.SpringReplGroup"
               text="Spring Boot REPL"
               popup="true">
            <add-to-group group-id="CodeMenu" anchor="last"/>
            <add-to-group group-id="EditorPopupMenu" anchor="last"/>
        </group>

        <!-- Run Selection -->
        <action id="hu.baader.repl.RunEditorSelection"
                class="hu.baader.repl.actions.RunEditorSelectionAction"
                text="Run Selection"
                description="Send selection (or whole file) to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="ctrl shift R" keymap="$default"/>
        </action>

        <!-- Evaluate at Caret -->
        <action id="hu.baader.repl.EvaluateAtCaret"
                class="hu.baader.repl.actions.EvaluateAtCaretAction"
                text="Evaluate at Caret"
                description="Send expression at caret to Spring REPL">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift E" keymap="$default"/>
        </action>

        <!-- Advanced Editor (session PSI + transcript, popup) -->
        <action id="hu.baader.repl.OpenAdvancedEditor"
                class="hu.baader.repl.actions.OpenAdvancedEditorAction"
                text="Advanced Editor"
                description="Open advanced Java editor with session PSI and transcript">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
        </action>

        <!-- Sync imports from editor file into JShell session -->
        <action id="hu.baader.repl.SyncImportsFromEditor"
                class="hu.baader.repl.actions.SyncImportsFromEditorAction"
                text="Sync Imports"
                description="Send current Java file imports to Spring REPL JShell session">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
        </action>

        <!-- Attach & Inject Dev Runtime -->
        <action id="hu.baader.repl.AttachDevRuntime"
                class="hu.baader.repl.actions.AttachDevRuntimeAction"
                text="Attach &amp; Inject Dev Runtime"
                description="Attach to a running JVM and load the dev runtime agent">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Bind Spring Context -->
        <action id="hu.baader.repl.BindSpringContext"
                class="hu.baader.repl.actions.BindSpringContextAction"
                text="Bind Spring Context"
                description="Bind Spring ApplicationContext into dev runtime for REPL usage">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
        </action>

        <!-- Reload Class from Editor -->
        <action id="hu.baader.repl.ReloadClassFromEditor"
                class="hu.baader.repl.actions.ReloadClassFromEditorAction"
                text="Reload Class"
                description="Compile and hot-swap current editor file into target JVM">
            <add-to-group group-id="hu.baader.repl.SpringReplGroup" anchor="last"/>
            <keyboard-shortcut first-keystroke="meta shift R" keymap="$default"/>
        </action>
    </actions>
</idea-plugin>
